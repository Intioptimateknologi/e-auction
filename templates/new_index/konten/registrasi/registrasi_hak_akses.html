{% extends 'new_index/base1.html' %}
{% load static %}
{% block extrahead %}

{% endblock  %}

{% block navbar %}
{% include 'new_index/parts/navbar_kosong.html' %}
{% endblock %}

{% block konten_isi %}

<div class="jdl_menu_bg col-md-12">
    <span class="jdl_menu">Hak Akses</span>
</div>
<div class="col-md-12 background_navtab">
    <ul class="nav nav-pills" id="custom-content-below-tab" role="tablist" >
        <li class="nav-item  navtabli">
            <a class="navtab nav-link text-bold active " id="custom-tabs-one-2-tab" data-toggle="pill" href="#custom-tabs-one-2" role="tab" aria-controls="custom-tabs-one-2" aria-selected="false"><i class="fa fa-heading"></i>&nbsp;&nbsp;Judul Seleksi</a>
        </li>
        <li class="nav-item  navtabli">
            <a class="navtab nav-link text-bold" id="custom-tabs-one-4-tab" data-toggle="pill" href="#custom-tabs-one-4" role="tab" aria-controls="custom-tabs-one-4" aria-selected="false"><i class="fa fa-fingerprint"></i>&nbsp;&nbsp;Akses Menu</a>
        </li>
        <li class="nav-item  navtabli">
            <a class="navtab nav-link text-bold" id="custom-tabs-one-5-tab" data-toggle="pill" href="#custom-tabs-one-5" role="tab" aria-controls="custom-tabs-one-5" aria-selected="false"><i class="fa fa-bars"></i>&nbsp;&nbsp;Hak Akses Menu</a>
        </li>
        <li class="nav-item  navtabli">
            <a class="navtab nav-link text-bold" id="custom-tabs-one-1-tab" data-toggle="pill" href="#custom-tabs-one-1" role="tab" aria-controls="custom-tabs-one-1" aria-selected="true"><i class="fa fa-person-circle-check"></i>&nbsp;&nbsp;Users Akses Menu</a>
        </li>
        <li class="nav-item  navtabli">
            <a class="navtab nav-link text-bold" id="custom-tabs-one-6-tab" data-toggle="pill" href="#custom-tabs-one-6" role="tab" aria-controls="custom-tabs-one-6" aria-selected="false"><i class="fa fa-person-shelter"></i>&nbsp;&nbsp;User Akses Seleksi</a>
        </li>
    </ul>
</div>
<div class="col-md-12" style="text-align:center; background:#4a91dc;margin-left:-1px;margin-right:0px;padding-top:10px; padding-bottom:10px;">
</div>

<div class="col-md-12" style="padding-left:40px;padding-top:10px;padding-right:40px;">
    <div class="row">
        <div class="col-md-12">
            <div class="tab-content" id="custom-tabs-one-tabContent">
                <div class="tab-pane fade" id="custom-tabs-one-1" role="tabpanel" aria-labelledby="custom-tabs-one-1-tab">
                    <div class="col-md-12" style="margin-bottom: 0px;">
                        <div style="display: flex;">
                            <div> 
                                <div class="jdl_tab">User Akses Menu</div>
                                <div class="jdl_sub_tab">Sistem Seleksi Pengguna Pita Frekuensi Radio</div>
                            </div>
                            <div class="col text-right">
                            </div>
                        </div>
                        <div class="card col">
                            <div class="row" style="margin:10px">
                                <table id="myTable_users" class="display" style="width:100%"  data-server-side="true" data-ajax="/userman/api/v1/UsersView/?format=datatables">
                                    <thead>
                                        <tr>
                                            <th data-data="id">ID</th>
                                            <th data-data="username">Username</th>
                                            <th data-data="nama_lengkap">Nama Pengguna</th>
                                            <th data-data="email">Email</th>
                                            <th data-data="user_type">Jenis Users</th>
                                            <th data-data="customGroup">Hak Akses</th>
                                            <th data-data="created"width="100px">Tanggal Dibuat</th>
                                            <th data-data="last_update"width="100px">Tanggal Diubah</th>
                                            <th data-data="dibuat_oleh">Dibuat Oleh</th>
                                            <th data-data="diubah_oleh">Diubah Oleh</th>
                                            <th width="100px">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                   

                <div class="tab-pane fade" id="custom-tabs-one-4" role="tabpanel" aria-labelledby="custom-tabs-one-4-tab" style="padding-left:50px;padding-right:50px;">
                    <div class="row">
                        <div class="col-md-12">
                            <div style="display: flex;">
                                <div class="col">
                                    <div class="jdl_tab">Akses Menu</div>
                                    <div class="jdl_sub_tab">Sistem Seleksi Pengguna Pita Frekuensi Radio</div>
                                </div>
                                <div class="col text-right">  
                                    <button type="button" id="tambah_data_group" class="btn btn-primary float-end tambah_btn"><i class="fa-solid fa-plus-circle"></i> Tambah Akses Menu</button>
                                </div>
                            </div>
                        </div>
                        <div class="card col">
                            <div class="row" style="margin:10px">
                                <table id="myTable_group" class="display" style="width:100%" data-server-side="true" data-ajax="/userman/api/v1/costumgroup/?limit=100&format=datatables">
                                    <thead>
                                        <tr>
                                            <th data-data="id">ID</th>
                                            <th data-data="name">Nama Group</th>
                                            <th data-data="keterangan">Keterangan</th>
                                            <th data-data="active">Status</th>
                                           
                                            <th data-data="last_updated"width="100px">Tanggal Diubah</th>
                                            <th data-data="dibuat_oleh">Dibuat Oleh</th>
                                            <th data-data="diubah_oleh">Diubah Oleh</th>
                                            <th width="100px" >Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="custom-tabs-one-5" role="tabpanel" aria-labelledby="custom-tabs-one-5-tab" style="padding-left:50px;padding-right:50px;">
                    <div class="row">
                        <div class="col-md-12" style="margin-bottom: 0px;">
                            <div style="display: flex;">
                                <div class="col">
                                    <div class="jdl_tab">Hak Akses Menu</div>
                                    <div class="jdl_sub_tab">Sistem Seleksi Pengguna Pita Frekuensi Radio</div>
                                </div>
                                <div class="col text-right">  
                                </div>
                            </div>
                        </div>
                        <div class="card col">
                            <div class="row" style="margin:10px">
                                <div class="row col-md-12">
                                   
                                    <label class="nama_label" style="padding-top: 0px; text-align:left">Pilih Group Akses Menu </label>
                                    <div class="col-md-12">
                                        <select class="form-control"  style="width:100%" id="pilih_group" name="pilih_group" required>
                                            <option disabled selected value="">Pilih Group</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <div id="myDiv">
                                            <table class="table" id="table_tahapan" style="width:100%">
                                                <thead>
                                                    <tr><th width="20px">Check</th><th>Daftar Modul</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- ko foreach: menus -->
                                                    <tr style="background-color:#4a91dc">
                                                        <td style="padding-top:2px; padding-bottom:2px; text-align:center;"><input type="checkbox" data-bind="checked: dipilih, click: $root.update" class="form-check-input" style="transform: scale(1.5);"></td>
                                                        <td style="padding-top:2px; padding-bottom:2px; text-align:left;"><b><span  style="font-size:18px;color:white" data-bind="text:name"></span></b></td>
                                                    </tr>
                                                        
                                                        <!-- ko foreach: leaf_nodes -->
                                                        <tr style="background-color:# ;">
                                                            <td style="padding-left:30px;padding-top:2px; padding-bottom:2px; text-align:right;">&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" data-bind="checked: dipilih, click: $root.update" class="form-check-input" style="transform: scale(1.5);"></td>
                                                            <td style="padding-top:2px; padding-bottom:2px; text-align:left;"><b><span data-bind="text:name"></span></b>
                                                                <table class="table table-sm" style="text-align:left;">
                                                                    <tbody data-bind="foreach: leaf_nodes">
                                                                    <tr>
                                                                        <td style="padding-left:50px;" width="20px"><input type="checkbox" data-bind="checked: dipilih, click: $root.update" class="form-check-input" style="transform: scale(1.5);">
                                                                        <td>&nbsp;&nbsp;<span data-bind="text:name"></span></td>
                                                                    </tr>
                                                                    </tbody>
                                                                </table>
                                                            </td>
                                                        </tr>
                                                        <!-- /ko -->
                                                    <!-- /ko -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="custom-tabs-one-6" role="tabpanel" aria-labelledby="custom-tabs-one-6-tab">
                    <div class="col-md-12" style="margin-bottom: 0px;">
                        <div style="row">
                            <div class="col-md-12" style="margin-bottom: 0px;">
                                <div style="display: flex;">
                                    <div>    
                                        <div class="jdl_tab">User Akses Seleksi</div>
                                        <div class="jdl_sub_tab">Sistem Seleksi Pengguna Pita Frekuensi Radio</div>
                                    </div>
                                </div>
                            </div>
                            <div class="card col-md-12">
                                <div class="row" style="margin:10px">
                                    <div class="row col-md-12">
                                       
                                        <label class="nama_label" style="padding-top: 0px; text-align:left">Piih Group Akses Menu </label>
                                        
                                        <div class="form-group col-md-12">
                                            <select class="form-control" style="width: 100%;" id="nmlelang" name="nmlelang" required>
                                                <option disabled selected value="">Pilih Judul Seleksi</option>
                                            </select>
                                        </div>
                                        <input type="hidden" id="item_lelang">
                                    </div>
                                </div>
                                <div class="col" style="margin-top:-20px;">
                                <ul class="nav nav-pills" id="custom-content-below-tab" role="tablist" >
                                    <li class="nav-item  navtabli">
                                        <a class="navtab nav-link active" data-toggle="pill" href="#panitia" role="tab"><i class="fa fa-user"></i>&nbsp;&nbsp;Auctioneer</a>
                                    </li>
                                    <li class="nav-item  navtabli">
                                        <a class="navtab nav-link text-bold" data-toggle="pill" href="#viewer1" role="tab"><i class="fa fa-users-line"></i>&nbsp;&nbsp;Viewer</a>
                                    </li>
                                    <li class="nav-item  navtabli">
                                        <a class="navtab nav-link text-bold" data-toggle="pill" href="#bidder1" role="tab"><i class="fa fa-users"></i>&nbsp;&nbsp;Bidder</a>
                                    </li>
                                </ul> 
                                </div>
                                <div class="tab-content" style="padding-left:20px">
                                    <div class="tab-pane fade show active" id="panitia" role="tabpanel">
                                        <div class="card">
                                            <div class="card-header">
                                                <div style="display: flex; justify-content: space-between; align-items: center; align-content: center; flex-wrap: nowrap; flex-direction: row;">
                                                    <div class="jdl_sub_tab">Auctioneer</div>
                                                    <button type="button" id="tambah_auctioner" class="btn btn-primary"><i class="fa-solid fa-plus-circle"></i> Tambah Baru</button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="col">
                                                    <table  id="t_auctioner" class="dt" style="width: 100%;text-align:center">
                                                        <thead style="text-align:center">
                                                            <tr style="text-align:center">
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div> 
                                    </div>
                                    <div class="tab-pane fade" id="viewer1" role="tabpanel">
                                        <div class="card">
                                            <div class="card-header">
                                                <div style="display: flex; justify-content: space-between; align-items: center; align-content: center; flex-wrap: nowrap; flex-direction: row;">
                                                    <div class="jdl_sub_tab">Viewer</div>
                                                    <button type="button" id="tambah_viewer" class="btn btn-primary"><i class="fa-solid fa-plus-circle"></i> Tambah Baru</button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="col">
                                                    <table  id="t_viewer" class="dt" style="width: 100%;">
                                                        <thead>
                                                            <tr>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div> 
                                    </div>
                                    <div class="tab-pane fade" id="bidder1" role="tabpanel">
                                        <div class="card">
                                            <div class="card-header">
                                                <div style="display: flex; justify-content: space-between; align-items: center; align-content: center; flex-wrap: nowrap; flex-direction: row;">
                                                    <div class="jdl_sub_tab">Bidder</div>
                                                    <button type="button" id="tambah_bidder" class="btn btn-primary"><i class="fa-solid fa-plus-circle"></i> Tambah Baru</button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                               
                                                <div class="col">
                                                    <table  id="t_bidder" class="dt" style="width: 100%;">
                                                        <thead>
                                                            <tr>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div> 
                                    </div>
                                </div> 
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade show active" id="custom-tabs-one-2" role="tabpanel" aria-labelledby="custom-tabs-one-2-tab">
                    <div class="col-md-12">
                        <div class="row" style="margin-bottom: 0px;padding-bottom: 16px;">
                            <div class="col-md-12" >
                                <div style="display: flex;">
                                    <div class="col">
                                        <div class="jdl_tab">Judul Seleksi</div>
                                        <div class="jdl_sub_tab">Sistem Seleksi Pengguna Pita Frekuensi Radio</div>
                                    </div>
                                    <div class="col text-right">
                                        <button type="button" id="tambah_data_judul_seleksi" class="btn btn-primary"><i class="fa-solid fa-plus-circle"></i> Tambah Judul Seleksi</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card col">
                                <div class="row" style="margin:10px">
                                    <table id="myTable_judul_seleksi" class="display" style="width:100%"  data-server-side="true" data-ajax="/adm_lelang/api/v1/item_lelang/?format=datatables">
                                        <thead style="background-color: #007bff; color: white;">
                                            <tr>
                                                <th data-data="id">ID</th>
                                                <th data-data="tahun">Tahun</th>
                                                <th data-data="nama_lelang">Judul Seleksi</th>
                                                <th data-data="Keterangan">Keterangan</th>
                                                <th data-data="tayang">Status</th>
                                                <th data-data="created"width="100px">Tanggal Dibuat</th>
                                                <th data-data="last_update"width="100px">Tanggal Diubah</th>
                                                <th data-data="dibuat_oleh">Dibuat Oleh</th>
                                                <th data-data="diubah_oleh">Diubah Oleh</th>
                                                <th width="100px">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="1" role="dialog" id="modal">
    <div class="modal-dialog" role="document">
      <div class="modal-content"></div>
    </div>
</div>
{% endblock %}

{% block footer %}
{% include 'new_index/parts/footer_dashboard.html' %}
{% endblock %}

{% block modal %}

{% endblock %}

{% block script %}
<script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script id="loopingMenuTemplate" type="text/html">
    <tr>
        <td>- &nbsp;<span data-bind="text:name"></td>
        <td><input type="checkbox" data-bind="checked: dipilih, click: $root.update"></td>
    </tr>
    <!-- ko template: { name: 'loopingMenuTemplate',  
        foreach: children } -->
    <!-- /ko -->     
</script>

{% include 'js_tambahan/js_tambahan.html' %}
<script>
    $("ul.nav-tabs a").click(function (e) {
        e.preventDefault();  
            $(this).tab('show');
    });
</script>
<script>
    function formatDate(date) {
        return moment(date).format('DD-MMM-YYYY HH:mm:ss').toUpperCase();
    }
$(document).ready(function(){
    $('#modal').on('shown.bs.modal', function() {
        $('.select2aa').select2({
            theme: 'bootstrap4', // Specify the theme here
            dropdownParent: $(this) // Use $(this) to refer to the current modal
        });
    });

    var judulSeleksiTable = $('#myTable_judul_seleksi').DataTable({
        "order": [[6, 'desc']],
        "language": {"search": "Cari Data / Informasi  :"},
        "columnDefs": [{"className": "dt-center", "targets": "_all"}],
        columns: [
        { "searchable": false, data: "id", className: "d-none"},
        { data: "tahun","searchable": true },
        { data: "nama_lelang", "searchable": true },
        { data: "keterangan", "searchable": true },
        { data: "tayang", "render": function (data, type, row, meta) { 
            if (data==true) {
                return "<span class='badge badge-success'>Aktif</span>"
            } else {
                return "<span class='badge badge-danger'>Non Aktif</span>"
            }
        } },
        { data: "created", "searchable": false, "orderable": true,"render": function(data, type, row){
            return formatDate(data);
        }},    
        { data: "last_updated", "searchable": false, "orderable": true, "render": function(data, type, row){
            return formatDate(data);
        }},
        { data: "dibuat_oleh", "searchable": false, "orderable": false, "render": function (data, type, row, meta) { 
            if (data) {
                return data
            } else {
                return "-"
            }
        } },
        { data: "diubah_oleh", "searchable": false, "orderable": false, "render": function (data, type, row, meta) { 
            if (data) {
                return data
            } else {
                return "-"
            }
        } },
       
        {data:null,render: (data, type, row) =>'<button id="'+row.id+'" class="edit_judul btn btn-warning btn-sm" data-toggle="tooltip" data-placement="right" title="Edit"><i class="fa fa-pen"></i></button>&nbsp;&nbsp;<button id="'+
        row.id+'" class="delete_judul btn btn-sm btn-danger" data-toggle="tooltip" data-placement="right" title="Delete"><i  class="fa fa-trash"></i></button>'}
      ]
    });

    $( "#tambah_data_judul_seleksi" ).on( "click", function() {
        showModal2({
            formURL: "/adm_lelang/adm_lelang/modal_itemlelang/",
            drfURL: "/adm_lelang/api/v1/item_lelang/",
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                $("#modal").modal('toggle');
                judulSeleksiTable.ajax.reload();
            }
        });
    } );
    $("#myTable_judul_seleksi").on("click",".edit_judul",function() {
        showEditModal({
            formURL: "/adm_lelang/adm_lelang/modal_itemlelang/"+this.id+'/',
            drfURL: "/adm_lelang/api/v1/item_lelang/"+this.id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                $("#modal").modal('toggle');
                judulSeleksiTable.ajax.reload();
            }
        });
    });
    $("#myTable_judul_seleksi").on("click",".delete_judul",function() {
        deleteData({
            drfURL: "/adm_lelang/api/v1/item_lelang/"+this.id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                judulSeleksiTable.ajax.reload();
            }
        });
    });
    $("#myTable_judul_seleksi").on('click','.toggle_judul',function(data){
        patchData({
            drfURL:  "/adm_lelang/api/v1/item_lelang/"+this.id+"/",
            data: JSON.stringify({'active': data.target.checked}),
            csrf: '{{csrf_token}}',
            method: "PUT",
        })
    });

    var usersTable = $('#myTable_users').DataTable({
        "order": [[7, 'desc']],
        "language": {"search": "Cari Data / Informasi  :"},
        "columnDefs": [{"className": "dt-center", "targets": "_all"}],
        columns: [
        { "searchable": false, data: "id", className: "d-none"},
        { "searchable": true },
        { "searchable": true },
        { "searchable": true },
        { "searchable": false, "orderable": false, "render": function(data){
        switch(data) {
                case "A":
                    return '<span class="badge bg-black">Admin</span>';
                    break;
                case "B":
                    return '<span class="badge badge-success">Bidder</span>';
                    break;
                case "C":
                    return '<span class="badge badge-primary">Auctioner</span>';
                    break;
                
                default:
                    return '<span class="badge badge-info">Viewer</span>';
            }
        }},
      
        { data:"customGroup","searchable": false,render: (data, type, row)=> {
            let i="";
            data.forEach(function(item){
                i = i + "<span class='badge badge-info'>"+item.name+"</span>&nbsp;&nbsp;";
                })
            return '&nbsp;'+i+'&nbsp;';
            }
        },
       
        { data: "created", "searchable": false, "orderable": true,"render": function(data, type, row){
            return formatDate(data);
        }},    
        { data: "last_updated", "searchable": false, "orderable": true, "render": function(data, type, row){
            return formatDate(data);
        }},
        { data: "dibuat_oleh", "searchable": false, "orderable": false, "render": function (data, type, row, meta) { 
            if (data) {
                return data
            } else {
                return "-"
            }
        } },
        { data: "diubah_oleh", "searchable": false, "orderable": false, "render": function (data, type, row, meta) { 
            if (data) {
                return data
            } else {
                return "-"
            }
        } },
        {data:null,render: (data, type, row) =>'<button id="'+row.id+'" class="edit_user btn btn-warning btn-sm"><i class="fa fa-pen"></i></button>'}
      ]
    });

    var groupTable = $('#myTable_group').DataTable({
        "order": [[4, 'desc']],
        "language": {
            "search": "Cari Data / Informasi  :"
        },
        "columnDefs": [
        {"className": "dt-center", "targets": "_all"}
        ],
        columns: [
        { "searchable": false, data: "id", className: "d-none"},
        { "searchable": true },
        { "searchable": true },
        { data: "active", "render": function (data, type, row, meta) { 
                if (data==true) {
                    return "<span class='badge badge-success'>Aktif</span>"
                } else {
                    return "<span class='badge badge-danger'>Non Aktif</span>"
                }
            } },
       
          
        { data: "last_updated", "searchable": true, "orderable": true, "render": function(data, type, row){
            return formatDate(data);
        }},
        { data: "dibuat_oleh", "searchable": false, "orderable": false, "render": function (data, type, row, meta) { 
            if (data) {
                return data
            } else {
                return "-"
            }
        } },
        { data: "diubah_oleh", "searchable": false, "orderable": false, "render": function (data, type, row, meta) { 
            if (data) {
                return data
            } else {
                return "-"
            }
        } },
        {data:null,render: (data, type, row) =>'<button id="'+row.id+'" class="edit btn btn-warning btn-sm edit_button"><i class="fa fa-pen"></i></button>&nbsp;&nbsp;<button id="'+
        row.id+'" class="delete btn btn-sm btn-danger delete_button"><i  class="fa fa-trash"></i></button>'}
        
      ]
    });
    $("#tambah_data_users").on( "click", function() {
        showModal2({
            formURL: "/userman/modal_users/",
            drfURL: "/userman/api/v1/Users/",
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                $("#modal").modal('toggle');
                usersTable.ajax.reload();
            }
        });        
    });
    $("#tambah_data_group").on( "click", function() {
        showModal2({
            formURL: "/userman/modal_costumgroup/",
            drfURL: "/userman/api/v1/costumgroup/",
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                $("#modal").modal('toggle');
                groupTable.ajax.reload();
            }
        });        
    });
    $('#myTable_users').on('click','.edit_user', function () {
        id = this.id
        showEditModal({
            formURL: "/userman/modal_users_group/"+id+'/',
            drfURL: "/userman/api/v1/Users/"+id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                $("#modal").modal('toggle');
                usersTable.ajax.reload();
            }
        });      
    })
    $('#myTable_group').on('click','.edit_button', function () {
        id = this.id
        showEditModal({
            formURL: "/userman/modal_costumgroup/"+id+'/',
            drfURL: "/userman/api/v1/costumgroup/"+id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                $("#modal").modal('toggle');
                groupTable.ajax.reload();
            }
        });      
    })
    $('#myTable_users').on('click','.delete', function () {
        id = this.id
        deleteData({
            drfURL: "/userman/api/v1/Users/"+id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                usersTable.ajax.reload();
            }
        });      
    })

    $('#myTable_group').on('click','.delete_button', function () {
        id = this.id
        deleteData({
            drfURL: "/userman/api/v1/costumgroup/"+id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(response) {
                groupTable.ajax.reload();
            }
        });      
    })

    var viewModel = {
        menus: ko.observableArray([]),        
        groupmenu: ko.observableArray([]),
        update: function(data) {
            console.log(data);
            var id = $('#pilih_group').find(':selected').val();

            $.ajax({
                method: 'GET',
                url: '/userman/api/v1/usermenugroup/'+data.id+'/update_group/?g='+id,
                contentType : 'application/json',
                dataType : 'json',
                success: function (data) {
                    data = data.results;
                    viewModel.groupmenu(data)
                }
            });
            return true;
        },
        find: function(id) {
            match = false
            viewModel.groupmenu().forEach(function(item,idx,arr){
                if (item.menu == id)
                    match = true
            })
            return match;
        }
    };
    ko.applyBindings(viewModel);

    $('#pilih_group').select2({
        ajax: {
          url: '/userman/api/v1/costumgroup/',
          processResults: function (data) {
            return {results: $.map(data.results, function (item) {
                return {
                    text: item.name + ' ('+item.keterangan+')',
                    id: item.id
                    }
                })
            }}
        }
      });

    $('#pilih_group').change(function() {
        var selectedValue = $(this).val();
        id_group = selectedValue;
        var id = $('#pilih_group').find(':selected').val();
        $.ajax({
            method: 'GET',
            url: '/userman/api/v1/usermenugroup/?limit=1000&group='+id,
            contentType : 'application/json',
            dataType : 'json',
            success: function (data) {
                data = data.results;
                viewModel.groupmenu(data)
            }
        });
        $.ajax({
            method: 'GET',
            url: '/userman/api/v1/usermenu/?limit=1000',
            contentType : 'application/json',
            dataType : 'json',
            success: function (data) {
                data = data.results;
                data.forEach(function(item, idx, arr) {
                    item.dipilih = viewModel.find(item.id);
                    item.leaf_nodes.forEach(function(item,idx,arr) {
                        item.dipilih = viewModel.find(item.id);
                        item.leaf_nodes.forEach(function(item,idx,arr) {
                            item.dipilih = viewModel.find(item.id);
                        })
                    });
                });
                viewModel.menus(data);
            }
        } );       
    });

    var item_lelang;

    var judul_lelang = $('#nmlelang').select2({
        ajax: {
        url: '/adm_lelang/api/v1/item_lelang',
        processResults: function (data) {
            return {results: $.map(data.results, function (item) {
                return {
                    text: item.nama_lelang,
                    id: item.id
                    }
                })
            }}
        }
    });

    //LOAD DATA
    function loadData(id) {
        $.ajax({
            url: '/adm_lelang/adm_lelang/detail_itemlelang/'+id + '/',
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var table = $("#obyek");
                table.empty();
                table.append(data);
            }
        });
    }

    function loadData_Bidder(id) {
        $.ajax({
            url: '/adm_lelang/adm_lelang/bidder_lelang/'+id + '/',
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var table = $("#t_bidder");
                table.empty();
                table.append(data);
            }
        });
    }
    function loadData_Auctioner(id) {
        $.ajax({
            url: '/adm_lelang/adm_lelang/auctioner_lelang/'+id + '/',
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var table = $("#t_auctioner");
                table.empty();
                table.append(data);
            }
        });
    }
    function loadData_Viewer(id) {
        $.ajax({
            url: '/adm_lelang/adm_lelang/viewer_lelang/'+id + '/',
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var table = $("#t_viewer");
                table.empty();
                table.append(data);
            }
        });
    }

  let id_item_lelang = null;
  $('#nmlelang').on('select2:select', function (e) {
    id_item_lelang = e.params.data.id;
    $("#item_lelang").val(id_item_lelang);
    //console.log(get_id_lelang());
    $("#updatejudul").prop('disabled', false);
    $("#disablejudul").prop('disabled', false);
    loadData(id_item_lelang)
    loadData_Bidder(id_item_lelang)
    loadData_Auctioner(id_item_lelang)
    loadData_Viewer(id_item_lelang)
  });
  
  //TAMBAH PART
  $("#tambah_bidder").click(function() { 
        if (document.getElementById('nmlelang').value) {
            showModal2({
                csrf: '{{csrf_token}}',
                formURL: "/adm_lelang/modal_bidderlelang/"+document.getElementById('nmlelang').value+"/",
                drfURL: "/adm_lelang/api/v1/bidder_lelang/",
                onSuccess: function(response) {
                    $("#modal").modal('hide');
                    loadData_Bidder(document.getElementById('nmlelang').value);
                }
            });
        } else
        swal.fire("Pilih dahulu judul seleksinyha")
  });

    $("#tambah_auctioner").click(function() { 
        if (document.getElementById('nmlelang').value) {
            showModal2({
                csrf: '{{csrf_token}}',
                formURL: "/adm_lelang/modal_auctionerlelang/"+document.getElementById('nmlelang').value+"/",
                drfURL: "/adm_lelang/api/v1/auctioner_lelang/",
                onSuccess: function(response) {
                    $("#modal").modal('hide');
                    loadData_Auctioner(document.getElementById('nmlelang').value);
                }
            });
        } else
        swal.fire("Pilih dahulu judul seleksinyha")
    });

    $("#tambah_viewer").click(function() { 
        if (document.getElementById('nmlelang').value) {
            showModal2({
                csrf: '{{csrf_token}}',
                formURL: "/adm_lelang/modal_viewerlelang/"+document.getElementById('nmlelang').value+"/",
                drfURL: "/adm_lelang/api/v1/viewer_lelang/",
                onSuccess: function(response) {
                    $("#modal").modal('hide');
                    loadData_Viewer(document.getElementById('nmlelang').value);
                }
            });
        } else
        swal.fire("Pilih dahulu judul seleksinyha")
    });

    $('#t_auctioner').on( 'click', '.auctioner_lelang_edit', function () {
        const id = this.id
        const lelangId = document.getElementById('nmlelang').value

        if (lelangId) {
            showModal2({
                csrf: '{{csrf_token}}',
                formURL: `/adm_lelang/modal_auctionerlelang/edit/${lelangId}/${id}/`,
                drfURL: `/adm_lelang/api/v1/auctioner_lelang/${id}/`,
                method: "PUT",
                onSuccess: function(response) {
                    $("#modal").modal('hide');
                    loadData_Auctioner(lelangId);
                }
            });
        } else {
            swal.fire("Pilih dahulu judul seleksinya.")
        }
    });

    $('#t_viewer').on( 'click', '.viewer_lelang_edit', function () {
        const id = this.id
        const lelangId = document.getElementById('nmlelang').value

        if (lelangId) {
            showModal2({
                csrf: '{{csrf_token}}',
                formURL: `/adm_lelang/modal_viewerlelang/edit/${lelangId}/${id}/`,
                drfURL: `/adm_lelang/api/v1/viewer_lelang/${id}/`,
                method: "PUT",
                onSuccess: function(response) {
                    $("#modal").modal('hide');
                    loadData_Viewer(lelangId);
                }
            });
        } else {
            swal.fire("Pilih dahulu judul seleksinya.")
        }
    });

    $('#t_bidder').on( 'click', '.bidder_lelang_edit', function () {
        const id = this.id
        const lelangId = document.getElementById('nmlelang').value

        if (lelangId) {
            showModal2({
                csrf: '{{csrf_token}}',
                formURL: `/adm_lelang/modal_bidderlelang/edit/${lelangId}/${id}/`,
                drfURL: `/adm_lelang/api/v1/bidder_lelang/${id}/`,
                method: "PUT",
                onSuccess: function(response) {
                    $("#modal").modal('hide');
                    loadData_Bidder(lelangId);
                }
            });
        } else {
            swal.fire("Pilih dahulu judul seleksinya.")
        }
    });

    //DELETE PART
    $("#t_bidder").on("click",".bidder_lelang_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/adm_lelang/api/v1/bidder_lelang/'+this.id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_Bidder(document.getElementById('item_lelang').value);
                });
            }
        });
    });

    $("#t_auctioner").on("click",".auctioner_lelang_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/adm_lelang/api/v1/auctioner_lelang/'+this.id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_Auctioner(document.getElementById('item_lelang').value);
                });
            }
        });
    });

    $("#t_viewer").on("click",".viewer_lelang_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/adm_lelang/api/v1/viewer_lelang/'+this.id+'/',
            csrf: '{{csrf_token}}',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_Viewer(document.getElementById('item_lelang').value);
                });
            }
        });
    });



});

</script>

{% endblock  %}
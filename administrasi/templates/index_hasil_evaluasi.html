{% extends 'new_index/base1.html' %}
{% load widget_tweaks %}
{% load static %}
{% load judul_tags %}

{% block extrahead %}
{% endblock %} 
{% block navbar %}
{% include 'new_index/parts/navbar_kosong.html' %}
{% endblock %}
{% block konten_isi %}

<div class="jdl_menu_bg col-md-12">       
    <p class="jdl_menu2">Administrasi &gt; Hasil Evaluasi</h1>
                </div>
                <div class="card-body">
                        {% if user_type == "C" %}
                        {% add_judul_auctioner user.id item_lelang.id "/administrasi/keikutsertaan/" %}
                        {% elif user_type == "V" %}
                        {% add_judul_viewer user.id item_lelang.id "/administrasi/keikutsertaan/" %}
                        {% elif user_type == "A" %}
                        {% add_judul_admin user.id item_lelang.id "/administrasi/keikutsertaan/" %}
                        {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
        
        <div class="card-body">        
            <div class="row">
                <ul class="nav nav-tabs col-md-12" id="myTab" role="tablist">
                    <!-- <li class="nav-item">
                        <a class="nav-link active" data-toggle="pill" href="#detil" role="tab">Detail Seleksi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#home" role="tab">Obyek Seleksi</a>
                    </li> -->
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="pill" href="#kirim" role="tab">Kirim Undangan Evaluasi Permohonan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#undangan" role="tab">Undangan Evaluasi Permohonan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#form" role="tab">Form Evaluasi Permohonan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#hasil" role="tab">Hasil Evaluasi Permohonan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#draft" role="tab">Draft BA Evaluasi Permohonan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#ba" role="tab">BA Evaluasi Permohonan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#upload" role="tab">Upload Pengumuman Hasil Evaluasi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" data-toggle="pill" href="#pengumuman" role="tab">Pengumuman Hasil Evaluasi</a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content col-md-12">
                    <div class="tab-pane " id="detil" role="tabpanel">
                        <div class="card p-3">
                            <div class="container px-5 my-5" id="item_lelang_display" >
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="home" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Obyek Seleksi&nbsp;</h2>
                                        <button id="tambah_obyek" class="btn btn-outline ml-2"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="obyek" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                                <th>Band</th>
                                                <th>Rentang Frekuensi</th>
                                                <th>Teknologi</th>
                                                <th>Reserved Price</th>
                                                <th>Eligibility/Block</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>             
                    <div class="tab-pane active" id="kirim" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Kirim Undangan Evaluasi Permohonan</h2>
                                        <button id="tambah_kirim" class="btn btn-outline ml-2"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_kirim" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="tab-pane" id="undangan" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Undangan Evaluasi Permohonan</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_kirim_undangan" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="tab-pane" id="form" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Form Evaluasi Permohonan</h2>
                                        <button id="tambah_form" class="btn btn-outline ml-2"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_form" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="tab-pane" id="hasil" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Hasil Evaluasi Permohonan</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_form_evaluasi" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="tab-pane" id="draft" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Draft BA Evaluasi Permohonan</h2>
                                        <button id="tambah_draft" class="btn btn-outline ml-2"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_draft" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="tab-pane" id="ba" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">BA Evaluasi Permohonan</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_ba" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="tab-pane" id="upload" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Upload Pengumuman Hasil Evaluasi</h2>
                                        <button id="tambah_pengumuman" class="btn btn-outline ml-2"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_pengumuman" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="tab-pane" id="pengumuman" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Pengumuman Hasil Evaluasi</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_pengumuman_hasil" class="dt" style="width: 100%">
                                        <thead>
                                            <tr>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div>
                </div>
            </div>    
        </div>
    </div>
    <div class="modal fade" tabindex="-1" role="dialog" id="modal">
        <div class="modal-dialog" role="document">
          <div class="modal-content"></div>
        </div>
      </div>
{% endblock %}

{% block footer %}
{% include 'new_index/parts/footer_dashboard.html' %}
{% endblock %}

{% block script %}
<script src="https://cdn.jsdelivr.net/npm/jquery-form@4.3.0/dist/jquery.form.min.js"></script>
<script>
$(document).on('change', '#id_file',function() {
        console.log(1);
        var fileInput = $(this);
        var file = fileInput[0].files[0];
        var fileType = file.type;
        
        if (fileType !== 'application/pdf') {
          alert('Hanya file PDF yang diperbolehkan.');
          $('#id_file').val('');
        }
    });


var item_lelang;
$(document).ready(function() {

  function loadData_draft(id) {
    $.ajax({
        url: '/administrasi/administrasi/ba_administrasi/'+id + '/HASIL/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_draft");
            table.empty();
            table.append(data);
            
        }
    });
  }
 
  function loadData_ba(id) {
    $.ajax({
        url: '/administrasi/administrasi/ba_administrasi2/'+id + '/HASIL/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_ba");
            table.empty();
            table.append(data);
            
        }
    });
  }

  function loadData_pengumuman(id) {
    $.ajax({
        url: '/administrasi/administrasi/hasil_evaluasi/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_pengumuman");
            table.empty();
            table.append(data);
            
        }
    });
  }

  function loadData_pengumuman_hasil(id) {
    $.ajax({
        url: '/administrasi/administrasi/hasil_evaluasi2/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_pengumuman_hasil");
            table.empty();
            table.append(data);
            
        }
    });
  }

  function loadData_kirim_undangan(id) {
    $.ajax({
        url: '/administrasi/administrasi/undgn_evaluasi/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_kirim");
            table.empty();
            table.append(data);
            
        }
    });
  }

  function loadData_kirim_undangan_evaluasi(id) {
    $.ajax({
        url: '/administrasi/administrasi/undgn_evaluasi2/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_kirim_undangan");
            table.empty();
            table.append(data);
            
        }
    });
  }

  function loadData_form(id) {
    $.ajax({
        url: '/administrasi/administrasi/form_evaluasi/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_form");
            table.empty();
            table.append(data);
            
        }
    });
  }

  function loadData_form_evaluasi(id) {
    $.ajax({
        url: '/administrasi/administrasi/form_evaluasi2/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#t_form_evaluasi");
            table.empty();
            table.append(data);
            
        }
    });
  }

  let id_item_lelang = null;

  id_item_lelang = $('#nmlelang').val();
    loadData_draft(id_item_lelang)
    loadData_ba(id_item_lelang)
    loadData_pengumuman(id_item_lelang)
    loadData_pengumuman_hasil(id_item_lelang)
    loadData_kirim_undangan(id_item_lelang)
    loadData_kirim_undangan_evaluasi(id_item_lelang)
    loadData_form(id_item_lelang)
    loadData_form_evaluasi(id_item_lelang)
  

  //CREATE
    $("#tambah_draft").click(function() { 
        showModal({
            formURL: "/administrasi/administrasi/modal_ba_hasil_evaluasi/"+document.getElementById('item_lelang').value+"/",
            drfURL: "/administrasi/api/v1/berita_acara/",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_draft(document.getElementById('item_lelang').value)
            }
        });
    });

    $("#tambah_pengumuman").click(function() { 
        showModal({
            formURL: "/administrasi/administrasi/modal_hasil_evaluasi/"+document.getElementById('item_lelang').value+"/",
            drfURL: "/administrasi/api/v1/hasil_evaluasi/",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_pengumuman(document.getElementById('item_lelang').value)
            }
        });
    });

    $("#tambah_kirim").click(function() { 
        showModal({
            formURL: "/administrasi/administrasi/modal_undgn_evaluasi/" + document.getElementById('item_lelang').value + "/",
            drfURL: "/administrasi/api/v1/undangan_evaluasi/",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_kirim_undangan(document.getElementById('item_lelang').value);
            }
        })
 
    });

    $("#tambah_form").click(function() { 
        showModal({
            formURL: "/administrasi/administrasi/modal_form_evaluasi/"+document.getElementById('item_lelang').value+"/",
            drfURL: "/administrasi/api/v1/form_evaluasi/",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_form(document.getElementById('item_lelang').value)
            }
        });
    });

    //EDIT
    $("#t_draft").on("click",".ba_pemeriksaan_update",function() {
        showModal({
            formURL: "/administrasi/administrasi/modal_update_ba_hasil_evaluasi/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/administrasi/api/v1/berita_acara/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_draft(document.getElementById('item_lelang').value);
            }
        })
    });

    $("#t_pengumuman").on("click",".evaluasi_hasil_update",function() {
        showModal({
            formURL: "/administrasi/administrasi/modal_update_hasil_evaluasi/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/administrasi/api/v1/hasil_evaluasi/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_pengumuman(document.getElementById('item_lelang').value);
            }
        })
    });

    $("#t_kirim").on("click",".evaluasi_undangan_update",function() {
        showModal({
            formURL: "/administrasi/administrasi/modal_update_undgn_evaluasi/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/administrasi/api/v1/undangan_evaluasi/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_kirim_undangan(document.getElementById('item_lelang').value);
            }
        })
    });

    $("#t_form").on("click",".form_evaluasi_update",function() {
        showModal({
            formURL: "/administrasi/administrasi/modal_update_form_evaluasi/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/administrasi/api/v1/form_evaluasi/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                loadData_form(document.getElementById('item_lelang').value);
            }
        })
    });

    //DELETE
    $("#t_draft").on("click",".ba_pemeriksaan_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/administrasi/api/v1/berita_acara/',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_draft(document.getElementById('item_lelang').value);
                });
            }
        });
    });

    $("#t_pengumuman").on("click",".evaluasi_hasil_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/administrasi/api/v1/hasil_evaluasi/',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_pengumuman(document.getElementById('item_lelang').value);
                });
            }
        });
    });

    $("#t_kirim").on("click",".evaluasi_undangan_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/administrasi/api/v1/undangan_evaluasi/',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_kirim_undangan(document.getElementById('item_lelang').value);
                });
            }
        });
    });

    $("#t_form").on("click",".form_evaluasi_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/administrasi/api/v1/form_evaluasi/',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_form(document.getElementById('item_lelang').value);
                });
            }
        });
    });
});

</script>
{% endblock %}
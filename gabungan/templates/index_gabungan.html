{% extends 'new_index/base1.html' %}
{% load widget_tweaks %}
{% load static %}
{% load judul_tags %}
{% block extrahead %}
<style>
    /* .navbar-expand{
        flex-wrap: nowrap;
        display: flex;
        justify-content: space-between;
    }
    a{
        text-decoration:none;
    }
    .sd-page.sd-body__page.sd-page__empty-header{
        background-color: white;
    }
    .sd-action-bar.sd-footer.sd-body__navigation.sd-clearfix{
        display: none;
    }

    
    a.active {
        border-bottom: 2px solid blue!important;
        background-color:transparent!important;
    }

    .nav-link {
    color: rgb(110, 110, 110);
    font-weight: 500;
    }
    .nav-link:hover {
    color: #55c57a;
    }

    .nav-pills .nav-link.active {
    color: black;
    background-color: white;
    border-radius: 0.5rem 0.5rem 0 0;
    font-weight: 600;
    }

    /* ul {
    list-style: none;
    margin-top: 1rem;
    padding-inline-start: 0;
    } */

    .table-striped > tbody > tr:nth-child(2n+1) > td, .table-striped > tbody > tr:nth-child(2n+1) > th {
        background-color: #d9ecff;
    }
   
    .aktif{
        color: #33cc33;
    }
    .aktif-striped{
        color: #33cc33;
    } */
    .gridStyle {
        border: 1px solid rgb(212,212,212);
        width: 100%; 
        height: 200px;
    }

    .card-footer{
        display: none;
    }
    .select2-container--default.select2-container--focus .select2-selection--multiple {
        height: 37px !important;   
    }

    .select2-container--default .select2-selection--multiple .select2-selection__rendered {
        height: 37px !important;   
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice {
        background-color: #007bff;
        border-color: #006fe6;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
        color: #fff;
    }
</style>
{% endblock %} 
    {% block navbar %}
    {% include 'new_index/parts/navbar_kosong.html' %}
    {% endblock %}
    {% block konten_isi %}
    {% comment %} <div class="container-fluid"> {% endcomment %}
        <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col-md-12">
                    <div class="card card-default">
                        <div class="card-header" style="background-color: #6C757D;">
                            <h1 style="color: white;font-size: 14px;font-weight: bold;">Setting &gt; Lelang Gabungan			
                            </h1>
                        </div>
                        <div class="card-body">
                            {% if user_type == "C" %}
                            {% add_judul_auctioner user.id item_lelang.id "/gabungan/management/" %}
                            {% elif user_type == "V" %}
                            {% add_judul_viewer user.id item_lelang.id "/gabungan/management/" %}
                            {% elif user_type == "A" %}
                            {% add_judul_admin user.id item_lelang.id "/gabungan/management/" %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">        
            {% comment %} <div class="row">
                <ul class="nav nav-tabs col-md-12" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="pill" href="#detil" role="tab">Detail Lelang</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="pill" href="#home" role="tab">Obyek Lelang</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="pill" href="#giat" role="tab">Penentuan Parameter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="pill" href="#panitia" role="tab">Penilaian Gabungan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="pill" href="#syarat" role="tab">Berita Acara</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="pill" href="#kirim" role="tab">Kirim Undangan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="pill" href="#undangan" role="tab">Undangan</a>
                    </li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content col-md-12">
                    <div class="tab-pane active" id="detil" role="tabpanel">
                        <div class="card p-3">   
                            <div class="container px-5 my-5" id="item_lelang_display" >
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="home" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Obyek Lelang&nbsp;</h2>
                                       
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="obyek" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>Band</th>
                                                <th>Rentang Frekuensi</th>
                                                <th>Teknologi</th>
                                                <th>Reserved Price</th>
                                                <th>Eligibility/Block</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="giat" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Penentuan Parameter&nbsp;</h2>
                                        <button id="tambah_p_parameter" class="btn btn-outline ml-2" style="margin-left: 20px;"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="p_parameter" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>Penentuan Parameter</th>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>                    
                    <div class="tab-pane " id="panitia" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Input Penilaian&nbsp;</h2>
                                        <button id="tambah_penilaian" class="btn btn-outline ml-2" style="margin-left: 20px;"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="p_gabungan" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>Penilaian Gabungan</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                    <br/>
                                    <h4>Ringkasan Akhir</h4>
                                    <table  id="p_sum_gabungan" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>Penilaian Gabungan</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="syarat" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Berita Acara Gabungan&nbsp;</h2>
                                        <button id="tambah_ba_gabungan" class="btn btn-outline ml-2" style="margin-left: 20px;"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="ba_gabungan" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>Dokumen BA</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="kirim" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Kirim Undangan</h2>
                                        <button id="tambah_kirim" class="btn btn-outline ml-2"><i class="icon text-light"><img style="height:18px;" src="/static/img/plus.svg"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col overflow-auto">
                                    <table  id="t_kirim" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="undangan" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="col-md-12 col-sm-12 table-responsive">
                                    <div class="form-group form-inline">
                                        <h2 style="color: rgb(0,114,228);font-size: 16px;font-weight: bold;">Undangan</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="col">
                                    <table  id="t_undangan" class="dt" style="width: 100%;">
                                        <thead>
                                            <tr>
                                                
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>     {% endcomment %}
            {% include "tabs_all.html" %}
        </div>
        <p style="display: none;" text="{{user.id}}" id="tricky_user_id"></p>
         <p style="display: none;" id="tricky_user_bidder_id"></p>
        <div class="modal fade" tabindex="-1" role="dialog" id="modal">
            <div class="modal-dialog" role="document">
              <div class="modal-content"></div>
            </div>
          </div>
{% endblock %}
{% block footer %}
{% include 'new_index/parts/footer_dashboard.html' %}
{% endblock %}

{% block script %}
{% comment %} <script src="https://cdn.jsdelivr.net/npm/jquery-form@4.3.0/dist/jquery.form.min.js"></script>
<script>
function deleteData(options) {
        var defaults = {
            element_id: "#form",
            form_id: "#form",
            id: null,
            drfURL: null,
            onSuccess: null,
            onError: null,
            errorClass: ".invalid",
        };
        var settings = $.extend(defaults, options);
        Swal.fire({
            icon: 'warning',
            title: 'Hapus data',
            text: "Ingin menghapus data ini ?",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Hapus',
            cancelButtonText: 'Batal',
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    method: 'DELETE',
                    url: settings.drfURL+settings.id+'/',
                    contentType : 'application/json',
                    headers: {'X-CSRFToken': '{{ csrf_token }}'},
                    dataType : 'json',
                    success: function (data) {
                        settings.onSuccess(data);
                    },
                    error: function(error) {
                        swal.fire("Menghapus gagal. Yang dihapus sudah ada obyeknya.")
                    }
                });
            } else if (result.isDenied) {
            }
        })
    };
var item_lelang;

$(document).ready(function() {
    $('#nmlelang').select2({
    ajax: {
      url: '/adm_lelang/api/v1/item_lelang',
      processResults: function (data) {
        return {results: $.map(data.results, function (item) {
            return {
                text: item.nama_lelang,
                id: item.id
                }
            })
        }}
    }
  });


  function loadData(id) {
    $.ajax({
        url: '/adm_lelang/adm_lelang/detail_itemlelang2/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#obyek");
            table.empty();
            table.append(data);
/*            $.each(data.results, function (a,b) {
                table.append("<tr><td>"+b.eligibility_point_per_block+"</td>" +
                    "<td>"+b.teknologi+"</td>"+
                    "<td>" + b.reserved_price + "</td>" +
                    "<td>" + b.band + "</td>" +
                    "<td>" + b.rentang_frekuensi + "</td></tr>");
            });*/
        }
    });
  }

  //  load data
  function load_itemlelang_form(data) {
        checkRecord({        
            drfURL: "/adm_lelang/api/v1/item_lelang/"+data+"/",
            onSuccess: function(response) {
                loadForm({
                    element_id: "#item_lelang_display",
                    form_id: "#item_lelang_form",
                    formURL: "/adm_lelang/adm_lelang/item_lelang/update/"+data+"/",
                    drfURL: "/adm_lelang/api/v1/item_lelang/"+data+"/",
                    method: 'PUT',
                    onSuccess: function(response) {
                    }
                });
            },
            onError: function(response) {
                loadForm({
                    element_id: "#item_lelang_display",
                    form_id: "#item_lelang_form",
                    formURL: "/adm_lelang/adm_lelang/item_lelang/update/"+data+"/",
                    drfURL: "/adm_lelang/api/v1/item_lelang/"+data+"/",
                    onSuccess: function(response) {
                    }
                });
            }
        });
    }


  function loadData2(id) {
    $.ajax({
        url: '/gabungan/gabungan/penentuan_parameter/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#p_parameter");
            table.empty();
            table.append(data);
/*            $.each(data.results, function (a,b) {
                table.append("<tr><td>"+b.eligibility_point_per_block+"</td>" +
                    "<td>"+b.teknologi+"</td>"+
                    "<td>" + b.reserved_price + "</td>" +
                    "<td>" + b.band + "</td>" +
                    "<td>" + b.rentang_frekuensi + "</td></tr>");
            });*/
        }
    });
  }
  function loadData3(id) {
    $.ajax({
        url: '/gabungan/gabungan/ba_gabungan/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#ba_gabungan");
            table.empty();
            table.append(data);
/*            $.each(data.results, function (a,b) {
                table.append("<tr><td>"+b.eligibility_point_per_block+"</td>" +
                    "<td>"+b.teknologi+"</td>"+
                    "<td>" + b.reserved_price + "</td>" +
                    "<td>" + b.band + "</td>" +
                    "<td>" + b.rentang_frekuensi + "</td></tr>");
            });*/
        }
    });
  } 
  function loadData4(id) {
    $.ajax({
        url: '/gabungan/gabungan/nilai_gabungan/'+id + '/',
        method: "GET",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var table = $("#p_gabungan");
            table.empty();
            table.append(data);
/*            $.each(data.results, function (a,b) {
                table.append("<tr><td>"+b.eligibility_point_per_block+"</td>" +
                    "<td>"+b.teknologi+"</td>"+
                    "<td>" + b.reserved_price + "</td>" +
                    "<td>" + b.band + "</td>" +
                    "<td>" + b.rentang_frekuensi + "</td></tr>");
            });*/
        }
    });
  }

  function loadData_kirim_undangan(id) {
        $.ajax({
            url: '/smra/undangan_smra_cca/'+id + '/GABUNGAN/',
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var table = $("#t_kirim");
                table.empty();
                table.append(data);
            }
        });
    }

    function loadData_undangan(id) {
        $.ajax({
            url: '/smra/undangan_smra_cca2/'+id + '/GABUNGAN/',
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var table = $("#t_undangan");
                table.empty();
                table.append(data);
            }
        });
    }

    function loadData_sum_gabungan(id) {
        $.ajax({
            url: '/gabungan/gabungan/sum_gabungan/'+id + '/',
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var table = $("#p_sum_gabungan");
                table.empty();
                table.append(data);
            }
        });
    }

  let id_item_lelang = null;
  $('#nmlelang').on('select2:select', function (e) {
    var id = e.params.data.id;
    $("#item_lelang").val(id);
    loadData(id);
    loadData2(id);
    loadData3(id);
    loadData4(id);
    load_itemlelang_form(id);
    loadData_kirim_undangan(id)
    loadData_undangan(id)
    loadData_sum_gabungan(id)
  });
//   $(".dt").DataTable({paging: false, ordering: false,info: false,searching: false});
  $("#item_lelang").ajaxForm({
    dataType:  'json', 
    success:   function(data) {console.log(data)},
    beforeSubmit: function(arr, $form, options) {
        console.log(arr);
        console.log($form);
        console.log(options);
        //return false;
      }      
  }); 

  //CREATE
  $("#tambah_kirim").click(function() { 
        showModal({
            formURL: "/gabungan/gabungan/modal_undangan/"+document.getElementById('item_lelang').value+"/",
            // drfURL: "/smra/api/v1/undangan_smra_cca/",
            // onSuccess: function(response) {
            //     $("#modal").modal('hide');
            //     loadData_kirim_undangan(document.getElementById('item_lelang').value)
            // }
        });
    });

  $("#tambah_obyeks").click(function(event) { 
    event.preventDefault(); 
    event.stopPropagation(); 
    showModal({
        formURL: "/adm_lelang/adm_lelang/modal_obyek_seleksi/"+document.getElementById('item_lelang').value+"/",
        drfURL: "/adm_lelang/api/v1/detail_itemlelang/",
        onSuccess: function(response) {
            $("#modal").modal('hide');
            loadData(document.getElementById('item_lelang').value);
        }
    });
});
$("#tambah_p_parameter").click(function(event) { 
    event.preventDefault(); 
    event.stopPropagation(); 
    showModal({
        formURL: "/gabungan/gabungan/modal_p_parameter/"+document.getElementById('item_lelang').value+"/",
        drfURL: "/gabungan/api/v1/penentuan_parameter/",
        onSuccess: function(response) {
            $("#modal").modal('hide');
            swal.fire({
                title: "Data Berhasil Ditambahkan !",
                text: "",
                icon: "success"
            }).then(function() {
                loadData2(document.getElementById('item_lelang').value);
            
            })
        }
    });
});
$("#tambah_penilaian").click(function(event) {
    swal.fire({
        icon: 'warning',
        title: 'Init data',
        text: "Ingin init data ini ?",
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Init',
        cancelButtonText: 'Batal',
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: '/gabungan/api/v1/penilaian_gabungan/'+document.getElementById('item_lelang').value+ '/init/',
                method: "GET",
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {
                    loadData4(document.getElementById('item_lelang').value);
                }
            });        
        }
    });
    /*event.preventDefault(); 
    event.stopPropagation(); 
    showModal({
        formURL: "/gabungan/gabungan/modal_p_gabungan/"+document.getElementById('item_lelang').value+"/",
        drfURL: "/gabungan/api/v1/penilaian_gabungan/",
        onSuccess: function(response) {
            $("#modal").modal('hide');
            swal.fire({
                title: "Data Berhasil Ditambahkan !",
                text: "",
                icon: "success"
            }).then(function() {
                loadData4(document.getElementById('item_lelang').value);
            })
        }
    });*/

});

$("#tambah_ba_gabungan").click(function(event) { 
    event.preventDefault(); 
    event.stopPropagation(); 
    showModal({
        formURL: "/gabungan/gabungan/modal_ba_gabungan/"+document.getElementById('item_lelang').value+"/",
        drfURL: "/gabungan/api/v1/ba_gabungan/",
        onSuccess: function(response) {
            $("#modal").modal('hide');
            swal.fire({
                title: "Data Berhasil Ditambahkan !",
                text: "",
                icon: "success"
            }).then(function() {
                loadData3(document.getElementById('item_lelang').value);
        })
        }
    });
});
$("#p_parameter").on("click",".p_parameter_delete",function() {
    console.log()
    Swal.fire({
        icon: 'warning',
        title: 'Hapus data',
        text: "Ingin menghapus data ini ?",
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Hapus',
        cancelButtonText: 'Batal',
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                method: 'DELETE',
                url: '/gabungan/api/v1/penentuan_parameter/'+this.id+'/',
                contentType : 'application/json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                dataType : 'json',
                success: function (data) {
                    swal.fire({
                        title: "Data Terhapus !",
                        text: "",
                        icon: "success"
                    }).then(function() {
                        loadData2(document.getElementById('item_lelang').value);
                    });
                },
                error: function(error) {
                    console.log(error);
                }
            });
        } 
        else if (result.isDenied) {

        }
    })
});

$("#ba_gabungan").on("click",".b_gabungan_delete",function() {
    console.log()
    Swal.fire({
        icon: 'warning',
        title: 'Hapus data',
        text: "Ingin menghapus data ini ?",
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Hapus',
        cancelButtonText: 'Batal',
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                method: 'DELETE',
                url: '/gabungan/api/v1/ba_gabungan/'+this.id+'/',
                contentType : 'application/json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                dataType : 'json',
                success: function (data) {
                    swal.fire({
                        title: "Data Terhapus !",
                        text: "",
                        icon: "success"
                    }).then(function() {
                        loadData3(document.getElementById('item_lelang').value);
                    });
                },
                error: function(error) {
                    console.log(error);
                }
            });
        } 
        else if (result.isDenied) {

        }
    })
}); 
$("#p_gabungan").on("click",".nilai_gabungan_delete",function() {
    console.log()
    Swal.fire({
        icon: 'warning',
        title: 'Hapus data',
        text: "Ingin menghapus data ini ?",
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Hapus',
        cancelButtonText: 'Batal',
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                method: 'DELETE',
                url: '/gabungan/api/v1/penilaian_gabungan/'+this.id+'/',
                contentType : 'application/json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                dataType : 'json',
                success: function (data) {
                    swal.fire({
                        title: "Data Terhapus !",
                        text: "",
                        icon: "success"
                    }).then(function() {
                        loadData4(document.getElementById('item_lelang').value);
                    });
                },
                error: function(error) {
                    console.log(error);
                }
            });
        } 
        else if (result.isDenied) {

        }
    })
}); 
    //DELETE
    $("#t_kirim").on("click",".undangan_delete",function() {
        deleteData({id: this.id, 
            drfURL: '/smra/api/v1/undangan_smra_cca/',
            onSuccess: function(data) {
                swal.fire({
                    title: "Data Terhapus !",
                    text: "",
                    icon: "success"
                }).then(function() {
                    loadData_kirim_undangan(document.getElementById('item_lelang').value)
                });
            }
        });
    });

    //UPDATE
    $("#t_kirim").on("click",".undangan_update",function() {
        showModal({
            formURL: "/gabungan/gabungan/modal_update_undangan/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/smra/api/v1/undangan_smra_cca/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                loadData_kirim_undangan(document.getElementById('item_lelang').value)
                $("#modal").modal('hide');
            }
        })
    });

    $("#obyek").on("click",".objek_seleksi_update",function() {
        showModal({
            formURL: "/adm_lelang/adm_lelang/modal_update_obyek_seleksi/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/adm_lelang/api/v1/detail_itemlelang/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                swal.fire({
                    title: "Data Berhasil Diupdate !",
                    text: "",
                    icon: "success"
                }).then(function(){
                loadData(document.getElementById('item_lelang').value);
                })
            }
        })
    });

    $("#p_parameter").on("click",".p_parameter_update",function() {
        showModal({
            formURL: "/gabungan/gabungan/modal_update_p_parameter/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/gabungan/api/v1/penentuan_parameter/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                swal.fire({
                    title: "Data Berhasil Diupdate !",
                    text: "",
                    icon: "success"
                }).then(function(){
                loadData2(document.getElementById('item_lelang').value);
                })
            }
        })
    });

    $("#ba_gabungan").on("click",".b_gabungan_update",function() {
        showModal({
            formURL: "/gabungan/gabungan/modal_update_ba_gabungan/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/gabungan/api/v1/ba_gabungan/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                swal.fire({
                    title: "Data Berhasil Diupdate !",
                    text: "",
                    icon: "success"
                }).then(function(){
                loadData3(document.getElementById('item_lelang').value);
                })
            }
        })
    });

    $("#p_gabungan").on("click",".nilai_gabungan_update",function() {
        showModal({
            formURL: "/gabungan/gabungan/modal_update_p_gabungan/"+this.id+"/"+ document.getElementById('item_lelang').value+"/",
            drfURL: "/gabungan/api/v1/penilaian_gabungan/"+this.id+"/",
            method: "PUT",
            onSuccess: function(response) {
                $("#modal").modal('hide');
                swal.fire({
                    title: "Data Berhasil Diupdate !",
                    text: "",
                    icon: "success"
                }).then(function(){
                    loadData4(document.getElementById('item_lelang').value);
                })
               
            }
        })
    });

    // 
    var base64_data_file;
    var item_lelang;

    $('#modal').on('shown.bs.modal', function() {
        var textValue = $('#data_modal').text();

        item_lelang = document.getElementById('item_lelang').value;
        $('.select2bs4').select2();

        // undangan add
        if (textValue === 'add_gabungan_undangan') {
            append_data_bidder();
            append_data_auct();

            // submit undagngan
            $('#coba').submit(function(event) {
                event.preventDefault();
                console.log("tertekan");
            
                var selectedOptions = [];
                var selectedOptions_auctioneer = [];
                $('#id_bidder_2 option:selected').each(function() {
                    selectedOptions.push($(this).val());
                });

                $('#id_auctioneer_2 option:selected').each(function() {
                    selectedOptions_auctioneer.push($(this).val());
                });

                console.log(selectedOptions);

                if (selectedOptions.length != 0) {
                    for (let index = 0; index < selectedOptions.length; index++) {
                    const element = selectedOptions[index];
                    
                    var formData = new FormData();
                    formData.append('link_file', $('#id_link_file')[0].files[0]);
                    formData.append('item_lelang', $('#id_item_lelang').val());
                    formData.append('nomor', $('#id_nomor').val());
                    formData.append('judul', $('#id_judul').val());
                    formData.append('tanggal', $('#id_tanggal').val());
                    formData.append('keterangan', $('#keterangan').val());
                    formData.append('tempat', $('#id_tempat').val());
                    formData.append('agenda', $('#id_agenda').val());
                    formData.append('link_teleconference', $('#id_link_teleconference').val());
                    formData.append('bidder', element);
                    formData.append('owner', "GABUNGAN");

                    console.log(formData);
                
                    $.ajax({
                        method: 'POST',
                        url: '/smra/api/v1/undangan_smra_cca/',
                        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                        processData: false,
                        contentType: false,
                        data: formData,
                        success: function(data) {
                            console.log(data);
                            if (index == selectedOptions.length-1) {
                                if (selectedOptions_auctioneer.length == 0) {
                                    swal.fire({
                                        title: "Berhasil !",
                                        text: "Data Berhasil Ditambah!",
                                        icon: "success"
                                    }).then(function() {
                                        $("#modal").modal('hide');
                                        loadData_kirim_undangan(document.getElementById('item_lelang').value);
                                    });
                                } else {
                                    auctioner(selectedOptions_auctioneer);
                                }
                                
                            }
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                }
                }else{
                    auctioner(selectedOptions_auctioneer);
                }

                
            });

            // looping
            function auctioner(arr){
                for (let index = 0; index < arr.length; index++) {
                    const element = arr[index];
                    
                    var formData = new FormData();
                    formData.append('link_file', $('#id_link_file')[0].files[0]);
                    formData.append('item_lelang', $('#id_item_lelang').val());
                    formData.append('nomor', $('#id_nomor').val());
                    formData.append('judul', $('#id_judul').val());
                    formData.append('tanggal', $('#id_tanggal').val());
                    formData.append('keterangan', $('#keterangan').val());
                    formData.append('tempat', $('#id_tempat').val());
                    formData.append('agenda', $('#id_agenda').val());
                    formData.append('link_teleconference', $('#id_link_teleconference').val());
                    formData.append('auctioneer', element);
                    formData.append('owner', "GABUNGAN");
                
                    $.ajax({
                        method: 'POST',
                        url: '/smra/api/v1/undangan_smra_cca/',
                        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                        processData: false,
                        contentType: false,
                        data: formData,
                        success: function(data) {
                            console.log(data);
                            if (index == arr.length-1) {
                                swal.fire({
                                    title: "Berhasil !",
                                    text: "Data Berhasil Ditambah!",
                                    icon: "success"
                                }).then(function() {
                                    $("#modal").modal('hide');
                                    loadData_kirim_undangan(document.getElementById('item_lelang').value);
                                });
                            }
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                }
            }

        }

        // ba add
        if (textValue === 'add_dokesel_draftba') {
            append_data_bidder();
            append_data_auct();

            // submit BA
            $('#ba_form').submit(function(event) {
                event.preventDefault();
                console.log("tertekan ba");
            
                var selectedOptions = [];
                var selectedOptions_auctioneer = [];
                $('#id_bidder_2 option:selected').each(function() {
                    selectedOptions.push($(this).val());
                });

                $('#id_auctioneer_2 option:selected').each(function() {
                    selectedOptions_auctioneer.push($(this).val());
                });

                if (selectedOptions.length != 0) {
                    for (let index = 0; index < selectedOptions.length; index++) {
                    const element = selectedOptions[index];
                    
                    var formData = new FormData();
                    formData.append('link_file', $('#id_link_file')[0].files[0]);
                    formData.append('item_lelang', $('#id_item_lelang').val());
                    formData.append('nomor', $('#id_nomor').val());
                    formData.append('judul', $('#id_judul').val());
                    formData.append('tanggal', $('#id_tanggal').val());
                    formData.append('keterangan', $('#keterangan').val());
                    formData.append('bidder', element);
                    formData.append('owner', "DOKUMEN");
                
                    $.ajax({
                        method: 'POST',
                        url: '/persiapan/api/v1/berita_acara_persiapan/',
                        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                        processData: false,
                        contentType: false,
                        data: formData,
                        success: function(data) {
                            console.log(data);
                            if (index == selectedOptions.length-1) {
                                if (selectedOptions_auctioneer.length == 0) {
                                    swal.fire({
                                        title: "Berhasil !",
                                        text: "Data Berhasil Ditambah!",
                                        icon: "success"
                                    }).then(function() {
                                        selesai();
                                    });
                                } else {
                                    auctioner_ba(selectedOptions_auctioneer);
                                }
                                
                            }
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                }
                } else {
                    auctioner_ba(selectedOptions_auctioneer);
                }
                
            });

            // looping
            function auctioner_ba(arr){
                for (let index = 0; index < arr.length; index++) {
                    const element = arr[index];
                    
                    var formData = new FormData();
                    formData.append('link_file', $('#id_link_file')[0].files[0]);
                    formData.append('item_lelang', $('#id_item_lelang').val());
                    formData.append('nomor', $('#id_nomor').val());
                    formData.append('judul', $('#id_judul').val());
                    formData.append('tanggal', $('#id_tanggal').val());
                    formData.append('keterangan', $('#keterangan').val());
                    formData.append('auctioneer', element);
                    formData.append('owner', "DOKUMEN");
                
                    $.ajax({
                        method: 'POST',
                        url: '/persiapan/api/v1/berita_acara_persiapan/',
                        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                        processData: false,
                        contentType: false,
                        data: formData,
                        success: function(data) {
                            console.log(data);
                            if (index == arr.length-1) {
                                swal.fire({
                                    title: "Berhasil !",
                                    text: "Data Berhasil Ditambah!",
                                    icon: "success"
                                }).then(function() {
                                    selesai();
                                });
                            }
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                }
            }
        }

        // edit
        if (textValue === 'edit_dokesel') {
                var selectedTexta = $('#id_bidder').find('option:selected').text();
                var selectedTextb = $('#id_auctioneer').find('option:selected').text();

                if (selectedTexta === '---------') {
                    $('#id_bidder').prop('disabled', true);
                } else {
                    $('#id_bidder').prop('disabled', false);
                }


                if (selectedTextb === '---------') {
                    $('#id_auctioneer').prop('disabled', true);
                } else {
                    $('#id_auctioneer').prop('disabled', false);
                }
        }
    });

    //append data
    function append_data_bidder(){

        $.ajax({
        method: 'GET',
        url: "/userman/api/api_join_users_bidder_lelang/"+item_lelang+"/",
        contentType : 'application/json',
        dataType : 'json',
            success: function (data) {
                var data_data = data;

                for (let index = 0; index < data_data.length; index++) {
                    const element = data_data[index];
                    $('#id_bidder_2').append('<option value="'+element.id_bidder+'">'+element.username+'('+element.nama_perwakilan+')</option>');
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

    function append_data_auct(){
        $.ajax({
        method: 'GET',
        url: "/userman/api/api_join_users_auctioneer_lelang/"+item_lelang+"/",
        contentType : 'application/json',
        dataType : 'json',
            success: function (data) {
                var data_data = data;

                for (let index = 0; index < data_data.length; index++) {
                    const element = data_data[index];
                    $('#id_auctioneer_2').append('<option value="'+element.id_auctioneer+'">'+element.username+'('+element.nama_perwakilan+')</option>');
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    }
    //append data
});


</script> {% endcomment %}

{% include 'js_tambahan/js_tambahan.html' %}

<script>
var item_lelang;
$(document).ready(function() {
    {% include "js/js_temp_all.html" %}
});

</script>
{% endblock %}